<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TCP/IP协议栈 | YunDid's Blog</title><meta name="keywords" content="计算机网络"><meta name="author" content="YunDid"><meta name="copyright" content="YunDid"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="TCP&#x2F;IP协议栈OSI七层模型 实现网络行业的兼容性   应用层  为用户提供接口&#x2F;interface 应用层协议: OICQ,HTTP,HTTPS,BT&#x2F;P2P qq底层协议为OICQ   表示层  呈现用户数据 (数据格式，数据加密)   会话层  会话管理(建立，维持，关闭，区分)   运输层  实现数据的可靠&#x2F;不可靠传输 运输层协议: TCP UDP(QQ)   网络层  提供三层寻址&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="TCP&#x2F;IP协议栈">
<meta property="og:url" content="http://example.com/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/index.html">
<meta property="og:site_name" content="YunDid&#39;s Blog">
<meta property="og:description" content="TCP&#x2F;IP协议栈OSI七层模型 实现网络行业的兼容性   应用层  为用户提供接口&#x2F;interface 应用层协议: OICQ,HTTP,HTTPS,BT&#x2F;P2P qq底层协议为OICQ   表示层  呈现用户数据 (数据格式，数据加密)   会话层  会话管理(建立，维持，关闭，区分)   运输层  实现数据的可靠&#x2F;不可靠传输 运输层协议: TCP UDP(QQ)   网络层  提供三层寻址&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/ma3.jpg">
<meta property="article:published_time" content="2021-07-07T00:00:00.000Z">
<meta property="article:modified_time" content="2021-07-06T23:44:48.446Z">
<meta property="article:author" content="YunDid">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/ma3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: YunDid","link":"链接: ","source":"来源: YunDid's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-07 07:44:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">46</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/ma3.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YunDid's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">TCP/IP协议栈</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-07T00:00:00.000Z" title="发表于 2021-07-07 08:00:00">2021-07-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-06T23:44:48.446Z" title="更新于 2021-07-07 07:44:48">2021-07-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="TCP/IP协议栈"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="TCP-IP协议栈"><a href="#TCP-IP协议栈" class="headerlink" title="TCP/IP协议栈"></a>TCP/IP协议栈</h1><h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><blockquote>
<p>实现网络行业的兼容性</p>
</blockquote>
<ul>
<li><p>应用层</p>
<blockquote>
<p>为用户提供接口/interface</p>
<p>应用层协议: OICQ,HTTP,HTTPS,BT/P2P</p>
<p>qq底层协议为OICQ</p>
</blockquote>
</li>
<li><p>表示层</p>
<blockquote>
<p>呈现用户数据 (数据格式，数据加密)</p>
</blockquote>
</li>
<li><p>会话层</p>
<blockquote>
<p>会话管理(建立，维持，关闭，区分)</p>
</blockquote>
</li>
<li><p>运输层</p>
<blockquote>
<p>实现数据的可靠/不可靠传输</p>
<p>运输层协议: TCP UDP(QQ)</p>
</blockquote>
</li>
<li><p>网络层</p>
<blockquote>
<p>提供三层寻址/IP地址和三层通信(路由器)功能</p>
<p>IP协议</p>
<p>ipconfig可查看本机IP地址</p>
</blockquote>
</li>
<li><p>数据链路层</p>
<blockquote>
<p>提供二层寻址/MAC地址和二层通信(交换机)功能</p>
</blockquote>
</li>
<li><p>物理层</p>
<blockquote>
<p>提供通信介质和接口标准</p>
</blockquote>
</li>
</ul>
<h3 id="OSI实现过程"><a href="#OSI实现过程" class="headerlink" title="OSI实现过程"></a>OSI实现过程</h3><p>OSI数据封装与解封装</p>
<h2 id="Ethernet协议"><a href="#Ethernet协议" class="headerlink" title="Ethernet协议"></a>Ethernet协议</h2><blockquote>
<p>以太网协议，用于实现<strong>链路层</strong>的数据传输和地址封装(MAC)</p>
</blockquote>
<p>三个字段</p>
<blockquote>
<p>destination： 目的MAC地址</p>
<p>source: 发送端MAC地址</p>
<p>Type: 上层协议</p>
</blockquote>
<p>MAC地址</p>
<ul>
<li>MAC地址的前半部分”OUI代码”厂商唯一标识符</li>
</ul>
<blockquote>
<p>全球唯一的48bit的物理地址</p>
<p>冒号分16进制表示</p>
</blockquote>
<h2 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h2><blockquote>
<p>互联网协议，用于实现网络层的不可靠的面向无连接的分组传输</p>
</blockquote>
<p>组成</p>
<blockquote>
<p>…</p>
<p>区分服务/服务质量 1byte</p>
<ul>
<li>DSCP</li>
</ul>
<p>TTL生存时间 1byte</p>
<blockquote>
<p>本质是为了解决IP数据报的“环路问题”!</p>
<p>占据带宽，cpu资源</p>
</blockquote>
<p>协议</p>
<blockquote>
<p>运输层的端口号，链路层的type类型值，网络层的协议，使上层协议能选择适当的协议解封装</p>
</blockquote>
<p>首部校验和</p>
<blockquote>
<p>让接收方验证此数据报是否完成或发生改动 </p>
</blockquote>
<p>分片</p>
<p>标识: ID从属的进程</p>
<p>标志: 保留位+DF位置+MF位</p>
<p>片偏移: 8byte为单位的分片数据部分在原分组中距离首部的偏移量</p>
<p>…</p>
</blockquote>
<h2 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h2><blockquote>
<p>地址解析协议，用于实现从IP地址到MAC地址的映射，询问目标IP对应的MAC地址</p>
</blockquote>
<p>ARP Request</p>
<blockquote>
<p>广播请求</p>
</blockquote>
<p>ARP Reply</p>
<blockquote>
<p>单播回应</p>
</blockquote>
<p>ARP 缓存</p>
<blockquote>
<p>ARP缓存表基于”后到优先”原则，IP与MAC的地址映射会被后到的映射覆盖</p>
</blockquote>
<p>常用命令</p>
<blockquote>
<p>arp -a 查看ARP表</p>
<p>arp -d 删除ARP表项</p>
<p>ping IP 测试网络连通性</p>
</blockquote>
<h3 id="ARP攻击"><a href="#ARP攻击" class="headerlink" title="ARP攻击"></a>ARP攻击</h3><p> 中间人拦截</p>
<ul>
<li>断网攻击</li>
<li>限速</li>
<li>窃取用户隐私</li>
</ul>
<p><code>注意:</code>但凡明文传输的应用,都可以被窃取!</p>
<h4 id="底层原理分析"><a href="#底层原理分析" class="headerlink" title="底层原理分析"></a>底层原理分析</h4><p>ARP扫描</p>
<blockquote>
<p>获取本局域网的所有主机的IP+MAC地址，根据MAC地址中的OUI还可获得品牌信息</p>
</blockquote>
<p>ARP欺骗</p>
<blockquote>
<p>中间人持续的发送成百上千的ARP欺骗包，即被伪造的ARP回应包</p>
</blockquote>
<p>Vmvare虚拟机网卡模式</p>
<blockquote>
<ol>
<li>NAT地址翻转模式 允许访问互联网，各虚拟机共享主机的IP地址</li>
<li>桥接模式 允许访问互联网，各虚拟机使用自己的IP地址(存在一个逻辑上的交换机使得为每个虚拟机均分配了一个IP地址)</li>
<li>主机模式 不允许访问互联网</li>
</ol>
</blockquote>
<p>攻击/渗透工具</p>
<blockquote>
<p>p2pover,cain</p>
</blockquote>
<h3 id="ARP防御"><a href="#ARP防御" class="headerlink" title="ARP防御"></a>ARP防御</h3><ul>
<li>网络设备</li>
</ul>
<blockquote>
<p>丢弃ARP欺骗包</p>
</blockquote>
<p>原理</p>
<blockquote>
<p> DAI-动态ARP检测技术</p>
<ol>
<li><p>交换机记录接口与IP地址与MAC地址的映射 port&lt;-&gt;MAC&lt;-&gt;IP,生成DAI检测表</p>
<blockquote>
<p>DAI检测表的生成</p>
<ol>
<li>手工绑定</li>
<li>DHCP侦听生成DHCP侦听表</li>
</ol>
</blockquote>
</li>
<li><p>对每个接口发回的ARP回应根据DAI表判断是否违规，违规则丢弃并进行惩罚! </p>
</li>
</ol>
</blockquote>
<ul>
<li>电脑/手机端</li>
</ul>
<p>ARP防火墙</p>
<blockquote>
<p>绑定正确的IP与MAC地址的映射，收到攻击包时不被欺骗</p>
<p>根据网络数据包的特征，自动识别局域网存在的ARP扫描行为和欺骗行为，并做出攻击判断(谁他妈干的，给爷干回去)</p>
</blockquote>
<p>ARP双向绑定/静态绑定</p>
<blockquote>
<p>静态绑定IP与MAC地址的映射，后到的映射不会更新旧的映射</p>
</blockquote>
<h2 id="ICMP协议"><a href="#ICMP协议" class="headerlink" title="ICMP协议"></a>ICMP协议</h2><blockquote>
<p>网际控制报文协议</p>
<p>运行在运输层协议，服务于IP协议</p>
<p><strong>实现链路连通性测试和链路追踪，实现链路差错报告</strong></p>
</blockquote>
<p>协议字段组成</p>
<blockquote>
<p>类型值/代码值 8|0请求 0|0回复 区分数据包类型</p>
<p>校验和 数据完整性校验</p>
<p>标识符 用于标志不同的ping进程</p>
<p>序列号 表示在此进程下的第几个包</p>
</blockquote>
<h3 id="ICMP协议应用"><a href="#ICMP协议应用" class="headerlink" title="ICMP协议应用"></a>ICMP协议应用</h3><h4 id="Ping命令"><a href="#Ping命令" class="headerlink" title="Ping命令"></a>Ping命令</h4><blockquote>
<p>探测目的主机是否有问题，探测本地到目的主机的延迟</p>
<p>基于ICMP协议的请求和回复来实现</p>
<p>echo request 回显请求</p>
<p>echo imply 回显应答</p>
</blockquote>
<p>DDOS攻击</p>
<blockquote>
<p> Distribute deny of service / <strong>分布式拒绝服务式攻击</strong></p>
<p> 发送海量报文，占用服务器资源，使其无法提供服务</p>
<p> DDOS攻击工具</p>
<ul>
<li><p>LOIC 图形化</p>
</li>
<li><p>Hping3</p>
</li>
</ul>
</blockquote>
<h4 id="Trace-route-tracert"><a href="#Trace-route-tracert" class="headerlink" title="Trace route/tracert"></a>Trace route/tracert</h4><blockquote>
<p><strong>利用TTL超时来实现链路追踪，”网络踩点”</strong></p>
<p>TTL值从1开始递增设置，直至到达目的地</p>
<p>通过为请求包设置特殊的TTL值，使得每经过相应路由，因生命期结束各路由将回复包含IP地址信息的超时回应报文</p>
<blockquote>
<p>超时回应报文与端口不可达报文格式</p>
<p>ICMP回应报文嵌套请求报文，用于通知发送发哪个请求报文出现了问题</p>
</blockquote>
<p><strong>同一条ICMP请求包将发送三次</strong></p>
</blockquote>
<p>Windows 链路追踪的实现原理</p>
<blockquote>
<p>请求包封装ICMP请求报文(终点回复ICMP应答报文)</p>
</blockquote>
<p>Lniux/Unix 链路追踪的实现原理</p>
<blockquote>
<p>请求包封装高端口的UDP包(终点将回复端口不可达报文)</p>
</blockquote>
<h2 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h2><blockquote>
<p>运输层使用<strong>16bit</strong>的端口号来标志一个端口，仅具有本地意义</p>
</blockquote>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><p>服务器使用的端口号</p>
<ul>
<li><p>熟知端口号</p>
<blockquote>
<p>系统端口号，最重要应用程序端口号</p>
</blockquote>
</li>
<li><p>登记端口号</p>
<blockquote>
<p>对应于重要应用程序的其他应用程序的端口号</p>
</blockquote>
</li>
</ul>
</li>
<li><p>客户端使用的端口号</p>
<ul>
<li><p>短暂端口号</p>
<blockquote>
<p>动态选择的客户端应用进程端口号，通信结束，端口号不再存在</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="UDP协议"><a href="#UDP协议" class="headerlink" title="UDP协议"></a>UDP协议</h2><blockquote>
<p>用户数据报协议，实现面向无连接不可靠的传输层协议</p>
<p>以UDP用户数据报为运输层协议数据单元</p>
<p>一次交付一个完整报文</p>
</blockquote>
<p>字段组成 8byte</p>
<blockquote>
<p>源端口 2byte</p>
<p>目标端口  2byte</p>
<p>长度  2byte</p>
<p>校验和(检查不止首部的全部数据报的完整性)  2byte</p>
</blockquote>
<p>特征</p>
<blockquote>
<p>数据报结构整洁</p>
<p>速度快</p>
<p>实时交互(视频流，实时交互，社交)</p>
</blockquote>
<p>基于UDP开发的协议</p>
<blockquote>
<p>DHCP,DNS,OICQ,TFTP</p>
</blockquote>
<h2 id="DNS协议"><a href="#DNS协议" class="headerlink" title="DNS协议"></a>DNS协议</h2><blockquote>
<p>域名解析协议 port: 53</p>
</blockquote>
<p>原理</p>
<blockquote>
<p>请求主机 -&gt; DNS域名请求 -&gt; DNS服务器 — Query 域名 -&gt; IP</p>
<blockquote>
<p>google: 8.8.8.8 / 8.8.4.4</p>
<p>114.114.114.114</p>
<p>阿里巴巴: 223.5.5.5</p>
</blockquote>
<p>DNS服务器 -&gt; DNS回复 -&gt; 请求主机 — Answers IP</p>
</blockquote>
<h2 id="DHCP-协议"><a href="#DHCP-协议" class="headerlink" title="DHCP 协议"></a>DHCP 协议</h2><blockquote>
<p>动态主机配置协议，用于实现对终端设备的动态IP信息分配</p>
<p><strong>先到先得，请求主机使用先到的IP地址作为其IP地址</strong></p>
<p>通过bootp(启动协议)抓包</p>
</blockquote>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ul>
<li><p>DHCP Client -&gt; DHCP Server</p>
<blockquote>
<p>DHCP Discover包，广播探测寻找局域网的DHCP Server</p>
</blockquote>
</li>
<li><p>DHCP Client &lt;- DHCP Server</p>
<blockquote>
<p>DHCP Offer包，用于预回复客户端，告知其即将给的IP地址</p>
</blockquote>
</li>
<li><p>DHCP Client -&gt; DHCP Server</p>
<blockquote>
<p>DHCP Request包，请求IP地址</p>
</blockquote>
</li>
<li><p>DHCP Client &lt;- DHCP Server</p>
<blockquote>
<p>DHCP ACK包，对客户端进行最终的正式确认(将预分配的IP地址移除<strong>本地地址池</strong>)</p>
</blockquote>
</li>
</ul>
<h3 id="协议字段"><a href="#协议字段" class="headerlink" title="协议字段"></a>协议字段</h3><ul>
<li><p>DHCP Discover</p>
<blockquote>
<p><img src="/images/Network/image-20210617215444395.png" alt="image-20210617215444395"></p>
<p>请求IP的主机使用0.0.0.0作为源IP，表示不知道/无</p>
</blockquote>
</li>
<li><p>DHCP Offer</p>
<blockquote>
<p><img src="/images/Network/image-20210617215613641.png" alt="image-20210617215613641"></p>
</blockquote>
</li>
<li><p>DHCP Request</p>
<blockquote>
<p><img src="/images/Network/image-20210617215655420.png" alt="image-20210617215655420"></p>
<p>此时并未真正获得IP因此源IP仍为0.0.0.0</p>
<p>相较于Discover包多了Option: (50)选项字段，指定requested IP</p>
</blockquote>
</li>
<li><p>DHCP ACK</p>
<blockquote>
<p><img src="/images/Network/image-20210617215745589.png" alt="image-20210617215745589"></p>
</blockquote>
</li>
</ul>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><blockquote>
<p>为什么需要再次请求与确认？</p>
<ol>
<li>DHCP是基于UDP的不可靠协议，包在传输过程中可能存在丢失情况，若仅仅为discover-&gt;offer，导致已从DHCP池中已移除的地址未被主机使用，存在地址浪费问题</li>
<li>解决多Server环境下地址冲突问题，因DHCP池中信息不同步，导致已分配的IP被再次分配，导致地址冲突问题</li>
</ol>
</blockquote>
<p><code>注意:</code></p>
<ol start="2">
<li>DHCP交互过程中，服务端为67端口，客户端为68端口</li>
</ol>
<h3 id="不同系统下的差异"><a href="#不同系统下的差异" class="headerlink" title="不同系统下的差异"></a>不同系统下的差异</h3><h4 id="Linux-Unix"><a href="#Linux-Unix" class="headerlink" title="Linux/Unix"></a>Linux/Unix</h4><blockquote>
<p>DHCP的交互过程都是广播包形式来实现的，目的IP采用255.255.255.255</p>
<ul>
<li><p>保证客户端与服务器一定能收到数据包</p>
</li>
<li><p>多DHCP Server局域网下，DHCP池被所有Server共享，为了保持DHCP池同步更新，需要让其他Server知晓DHCP池中某个IP地址已被分配</p>
</li>
</ul>
<p>抗干扰/冲突能力强，不安全</p>
</blockquote>
<h4 id="Windows-Mac-os"><a href="#Windows-Mac-os" class="headerlink" title="Windows/Mac os"></a>Windows/Mac os</h4><blockquote>
<p>DHCP的交互过程仅 C -&gt; S 都是广播包形式来实现的，目的IP采用255.255.255.255</p>
<p>S -&gt; C 的包认定请求主机的IP就为预分配的IP，目的IP采用预分配的IP</p>
<p>抗干扰/冲突能力弱，安全</p>
</blockquote>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><blockquote>
<p>ipconfig /all 详细查看ip配置信息</p>
<p>ipconfig /release 释放IP地址</p>
<p>ipconfig /renew 重新分配IP地址</p>
</blockquote>
<h2 id="Soctet套接字"><a href="#Soctet套接字" class="headerlink" title="Soctet套接字"></a>Soctet套接字</h2><blockquote>
<p>套接字Socket = IP地址 + 端口号</p>
</blockquote>
<h2 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h2><blockquote>
<p>传输控制协议，是TCP/IP协议栈中算法最大，功能最复杂的协议</p>
<p>面向连接的可靠交付的提供<strong>全双工通信</strong>的运输层协议</p>
<p>以TCP报文<strong>段</strong>为运输层协议数据单元</p>
<p>面向字节流而非完整报文</p>
<p>被套接字唯一确定的点对点通信</p>
</blockquote>
<h3 id="TCP报文段首部"><a href="#TCP报文段首部" class="headerlink" title="TCP报文段首部"></a>TCP报文段首部</h3><blockquote>
<p><img src="/images/Network/image-20210619082431169.png" alt="image-20210619082431169"></p>
<ul>
<li><p>源目端口</p>
</li>
<li><p>序号</p>
</li>
</ul>
<blockquote>
<p>对TCP传送的每个字节都按序编号</p>
<p>序号字段标识本报文段发送的数据的第一个字节的序号</p>
</blockquote>
<ul>
<li><p>确认号</p>
<blockquote>
<p>期望收到对方下一个报文段的第一个数据字节的序号</p>
<p>收到确认号为N，则N之前的所有数据均以正确收到</p>
</blockquote>
</li>
<li><p>数据偏移 (以4byte为计量单位)</p>
<blockquote>
<p>数据起始对于报文段起始的偏移指明<strong>TCP报文段首部长度</strong></p>
</blockquote>
</li>
<li><p>保留</p>
<blockquote>
<p>保留供以后使用</p>
</blockquote>
</li>
</ul>
<p>6个控制位</p>
<ul>
<li><p>紧急URG</p>
<blockquote>
<p>表示具有高传送优先级</p>
</blockquote>
</li>
<li><p>确认ACK</p>
<blockquote>
<p>连接建立以后所有传送的报文必须将ACK置为1</p>
</blockquote>
</li>
<li><p>推送PSH</p>
<blockquote>
<p>考虑到缓存，发送方希望缓存即使未满接收方也能立即回复</p>
</blockquote>
</li>
<li><p>复位RST</p>
<blockquote>
<p>重置位，重新建立连接</p>
</blockquote>
</li>
<li><p>同步SYN</p>
<blockquote>
<p>连接建立时同步序号</p>
</blockquote>
</li>
<li><p>终止FIN</p>
<blockquote>
<p>释放连接</p>
</blockquote>
</li>
</ul>
<ul>
<li><p>窗口</p>
<blockquote>
<p>指明现在允许对方发送的数据量</p>
<p>告知接收方自己的接受窗口大小以便其设置其发送窗口大小</p>
</blockquote>
</li>
<li><p>校验和</p>
<blockquote>
<p>校验首部与数据的完整性</p>
</blockquote>
</li>
<li><p>紧急指针</p>
<blockquote>
<p>指明紧急数据的字节数</p>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="停止等待协议-自动重传请求ARQ"><a href="#停止等待协议-自动重传请求ARQ" class="headerlink" title="停止等待协议  / 自动重传请求ARQ"></a>停止等待协议  / 自动重传请求ARQ</h3><blockquote>
<p><strong>每</strong>发送一个分组就停止发送，等待确认</p>
<p>收到确认后再发送下一个分组。</p>
<p>分组和确认需要进行编号</p>
</blockquote>
<p>发送方</p>
<blockquote>
<p>发送方<strong>每</strong>发送完一个分组就保留该分组的副本并设置一个超时计时器</p>
<p>指定时间内未收到确认，则重传副本</p>
<p>对于已收到确认信息的分组再次收到确认信息，直接丢弃</p>
</blockquote>
<p>接收方</p>
<ul>
<li><p>分组出现差错</p>
<blockquote>
<p>对出现差错的分组直接丢弃，正确分组回复确认</p>
</blockquote>
</li>
<li><p>确认丢失</p>
<blockquote>
<p>再次收到分组时丢弃分组并再次发送确认</p>
</blockquote>
</li>
<li><p>确认迟到</p>
<blockquote>
<p>再次收到分组时丢弃分组并再次发送确认</p>
</blockquote>
</li>
</ul>
<h3 id="连续ARQ协议"><a href="#连续ARQ协议" class="headerlink" title="连续ARQ协议"></a>连续ARQ协议</h3><blockquote>
<p>ARQ协议信道利用率低，因此采用流水线传输，一次传送多个分组</p>
<p>连续发送 + 累积确认</p>
<p>接收方无需对每一个分组进行确认，而只需对<strong>按序到达</strong>的最后一个分组发送确认</p>
</blockquote>
<h3 id="可靠传输"><a href="#可靠传输" class="headerlink" title="可靠传输"></a>可靠传输</h3><h4 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h4><blockquote>
<p>以单工A -&gt; B为例，实际为全双工通信</p>
</blockquote>
<p><strong>发送窗口</strong></p>
<p>组成</p>
<blockquote>
<p><img src="/images/Network/image-20210619101316606.png" alt="image-20210619101316606"></p>
<p>使用三个指针来指明发送窗口的状态</p>
<p>-p1: 已发送已确认的字节，需要从发送缓存中删除</p>
<p>p1: 后沿 </p>
<p>p2 - p1: 已发送未收到确认</p>
<p>p2: 最后发送的字节的位置</p>
<p>p3 - p2: 允许发送但未发送的字节  (可用窗口)</p>
<p>p3: 前沿</p>
<p>p2-: 不允许发送的数据</p>
</blockquote>
<p>原理</p>
<blockquote>
<ol>
<li>有序发送发送窗口内的字节，窗口外的不允许发送</li>
<li>根据接收到的确认将发送窗口后沿前移至确认字节(接收方期望收到的字节)处，并根据返回的窗口值设置发送窗口的大小</li>
<li>若收到的窗口值变小，则前沿后移</li>
<li>若在超时计时器时间内仍未收到确认信息，则重传对应字节</li>
<li>若发送窗口中的字节均已发送,即可用窗口为0，则停止发送，等待确认信息调整发送窗口后继续发发送</li>
</ol>
</blockquote>
<p><strong>接收窗口</strong></p>
<blockquote>
<p><img src="/images/Network/image-20210619102036666.png" alt="image-20210619102036666"></p>
<p>已发送且交付给主机的字节将从接受缓存中删除</p>
</blockquote>
<p>原理</p>
<blockquote>
<ol>
<li>接受窗口对于接受到的允许接受的数据先暂存到接受窗口中</li>
<li>若有序则将有序字节交付目的主机，接收窗口向后移动对应字节，将接受缓存中的对应字节删除，并向发送方发送下一字节位置的确认</li>
<li>若无序且在接收窗口之内则先将收到的数据暂存于接受窗口中，不发送确认，直到接收到缺漏的字节才发送有序字节对最后一个字节的确认</li>
<li>重复步骤1</li>
</ol>
</blockquote>
<p>SACK 选择确认机制</p>
<blockquote>
<p>对于收到的无序且在接收窗口之内字节块，可以将这些字节块的边界信息告知发送方使其不用再重传这些字节块，而只需重传中间缺失的字节块</p>
<p>· but</p>
<p>双方的TCP报文段需要增设SACK选项，用于指明边界</p>
</blockquote>
<p><code>注意:</code></p>
<ol>
<li>A与B的发送接受窗口大小不总是一样大，因为时间滞后性且发送窗口受拥塞情况的限制</li>
<li>TCP要求接收方必须具有累积确认(发送数据时捎带确认信息)或者捎带确认的机制</li>
</ol>
<p>经典重传机制</p>
<blockquote>
<p>正常</p>
<p>ACK(n+1) = Seq(n) + Len(n)</p>
<p>丢包</p>
<p>ACK(n+1) &lt; Seq(n) + Len(n)</p>
<p>​                ↓    ACK(n+1)为第一次丢包处的序号，从此丢包处起即使已传递的后续包仍需重传</p>
<p>Seq(n+1) = ACK(n+1)</p>
</blockquote>
<p>选择重传机制</p>
<p>超时重传机制</p>
<h4 id="重传时间的RTO的选择"><a href="#重传时间的RTO的选择" class="headerlink" title="重传时间的RTO的选择"></a>重传时间的RTO的选择</h4><blockquote>
<p>RTO过大，将导致网络空闲时间过大，使网络传输效率降低</p>
<p>RTO过小，将导致很多没有必要的重传，加重网络负荷</p>
<p>RTO需要略大于往返时间RTT</p>
</blockquote>
<p><strong>RTO的计算</strong></p>
<p>RFC6298标准</p>
<p>未发生重传时RTO计算</p>
<blockquote>
<p>RTO = RTTS + 4*RTTD</p>
</blockquote>
<p>RTTS</p>
<blockquote>
<p>加权平均往返时间</p>
<p>RTT因网络影响并不固定，因此RTO无法使用某一次的RTT来作定量计算</p>
<p>RTTS(初始) = RTT</p>
<p>RTTS = (1-a) * 旧RTTS + a * 本次RTT</p>
<p>a = 1 / 8</p>
</blockquote>
<p>RTTD</p>
<blockquote>
<p>RTT偏差的加权平均</p>
<p>RTTD(初始) = RTT / 2</p>
<p>RTTD = (1-b) * 旧RTTD + b * | 本次RTTS - 本次RTT |</p>
<p>b = 1 / 4</p>
</blockquote>
<p><strong>发生重传时的RTO计算</strong></p>
<blockquote>
<p>发生重传时若仍采用上述方法计算RTO，则因为发送方可能对收到的确认识别出现差错，导致无法识别该确认为重传的确认信息还是正常传输的延时确认信息，导致RTT的测量出现差错，进而导致RTO不准确导致新的问题</p>
<p>Karn算法</p>
<p>只要报文段重传，不采用RTT样本计算，此次重传不更新RTO</p>
<p>由于超时重传时间无法更新，滞后性导致新的问题，比如往后得传送RTT均大于RTO，此不是一直重传</p>
<p>Karn算法修正</p>
<p>RTTO = 旧RTTO * 2</p>
</blockquote>
<h3 id="TCP流量控制"><a href="#TCP流量控制" class="headerlink" title="TCP流量控制"></a>TCP流量控制</h3><blockquote>
<p>控制发送方的发送速率，使接收方能够稳定接受，否则发送方发送过快，接收方来不及接受，从而造成数据丢失</p>
</blockquote>
<p><strong>通过滑动窗口实现流量控制</strong></p>
<blockquote>
<p>接收方通过发送TCP报文段的首部窗口位告知发送方可接受的发送窗口大小从而使发送方调整自己的发送窗口</p>
</blockquote>
<p><strong>零窗口通知</strong></p>
<blockquote>
<p>当接收方无缓存接受数据时，发送的确定报文段rwnd=0时，发送方调整发送窗口为0不再发送数据</p>
<p>此时若没有机制处理，则双方持续等待(发送方等待rwnd!=0的确认调整发送窗口，接收方有缓存时等待发送方的数据)，导致死锁</p>
<p>-</p>
<ol>
<li><p>当发送方收到rwnd=0的确认信息后，启动<strong>持续计时器</strong>，该时间内未收到确认则发送<strong>大小为1字节</strong>的零窗口通知，并为该通知创建副本和超时重传计时器</p>
</li>
<li><p>接收方无论是否有缓存可接受都必须接受，若返回rwnd=0的确认报文段则持续1，否则打破死锁</p>
</li>
</ol>
</blockquote>
<h3 id="TCP拥塞控制"><a href="#TCP拥塞控制" class="headerlink" title="TCP拥塞控制"></a>TCP拥塞控制</h3><blockquote>
<p>对某一资源的需求大于其所能提供的，则会使得网络出现拥塞，导致网络吞吐量随传输轮次的增大而减小，最终导致网络吞吐量为0</p>
<p>发送方会维护一个cwnd拥塞窗口，该窗口随网络拥塞情况动态变化</p>
<p>ssthresh慢开始门限，当cwnd&lt;ssthresh时采用慢开始算法，cwnd&gt;ssthresh时采用拥塞避免算法，cwnd=ssthresh均可采用</p>
</blockquote>
<p><strong>拥塞控制算法</strong></p>
<ul>
<li><p>慢开始</p>
<blockquote>
<p>cwnd初始值设置为1</p>
<p>cwnd随传输轮次的增加一次而加倍增加，一般增加2倍</p>
<p>当cwnd值到达ssthresh慢开始门限时，开始执行拥塞避免算法</p>
<p>当发送超时重传时，认为网络出现拥塞，将ssthresh值为当前cwnd的一半，cwnd值重新设置为1</p>
</blockquote>
</li>
<li><p>拥塞避免</p>
<blockquote>
<p>cwnd随传输轮次的增大呈每次加一线性增长</p>
</blockquote>
</li>
<li><p>快重传</p>
<blockquote>
<p>为了避免部分报文段丢失使发送方认为出现拥塞实际没有出现从而导致网络传输效率下降</p>
<ul>
<li>接收方不再捎带确认，而是每次收到报文段都对已有序收到的报文段立即发送确认</li>
</ul>
<p>发送方连续收到3次对相同报文段的确认，则进行快恢复算法</p>
</blockquote>
</li>
<li><p>快恢复</p>
<blockquote>
<ul>
<li><p>当发送发连续收到3次对相同报文段的确认时，将ssthresh和cwnd均置为当前cwnd的一半并开始执行拥塞避免算法</p>
</li>
<li><p>当发送发连续收到3次对相同报文段的确认时，将ssthresh置为当前cwnd的一半，cwnd置为新 ssthresh + 3 并开始执行拥塞避免算法</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="TCP运输管理"><a href="#TCP运输管理" class="headerlink" title="TCP运输管理"></a>TCP运输管理</h3><p><strong>TCP连接建立</strong></p>
<blockquote>
<p><strong>三次握手</strong></p>
<p><img src="/images/Network/image-20210620073437492.png" alt="image-20210620073437492"></p>
<p><strong>三握手连接而非二次握手</strong></p>
<blockquote>
<p>当TCP连接请求报文因时间延误，发生超时重传并且连接请求延误报文于第一次连接释放时到达TCP服务器，导致TCP进入了连接建立状态，而TCP客户对此次TCP服务器发送的连接确认不予理睬，导致TCP服务器资源浪费</p>
</blockquote>
</blockquote>
<p><strong>数据传输</strong></p>
<p><strong>TCP释放连接</strong></p>
<blockquote>
<p><strong>四次挥手</strong></p>
<p><img src="/images/Network/image-20210620082437457.png" alt="image-20210620082437457"></p>
<p><strong>Time wait的必要性</strong></p>
<blockquote>
<p>若服务器最终确认报文发生超时重传，若无TCP客户无时间等待态，则提前关闭连接可能造成不对TCP服务器的最终确认报文响应，导致TCP服务器无法关闭连接</p>
</blockquote>
<p><strong>TCP客户故障处理</strong></p>
<blockquote>
<p>若建立连接以后TCP客户发生故障，则无法对TCP服务器作出响应</p>
<p>TCP服务器将设置一个<strong>保活计时器</strong>，每次收到TCP客户发送的数据时便更新并重启保活计时器</p>
<p>若规定时间内未收到响应，则<strong>每75s</strong>发送一个<strong>探测报文</strong>，<strong>连续10次</strong>未收到响应则认为TCP客户发生故障，断开连接</p>
</blockquote>
</blockquote>
<h3 id="基于TCP的协议"><a href="#基于TCP的协议" class="headerlink" title="基于TCP的协议"></a>基于TCP的协议</h3><blockquote>
<p>http 80</p>
<p>https 443</p>
<p>ftp 20/21</p>
<p>ssh 22</p>
<p>telnet 23</p>
<p>smtp/pop 25/100</p>
</blockquote>
<h2 id="Telnet协议"><a href="#Telnet协议" class="headerlink" title="Telnet协议"></a>Telnet协议</h2><blockquote>
<p>远程登录协议，用于对设备进行远程管理，基于明文，建议更安全的SSH</p>
<p>telnet 12.0.1.28</p>
<p>telnet route-server.ip.att.net</p>
</blockquote>
<p>多路复用</p>
<blockquote>
<p>发送方不同的应用进程可以使用同一个运输层协议传送数据</p>
<p>TCP通过端口号port / 套接字Socket 实现多路复用</p>
<p>源目IP + 源目Port + 协议号 = 五元组</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">YunDid</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/">http://example.com/2021/07/07/Network/TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">YunDid's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></div><div class="post_share"><div class="social-share" data-image="/img/ma3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/07/Network/Network_Layor/"><img class="prev-cover" src="/img/ma3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Network</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/26/CS106B/CS106B-L11-14/"><img class="next-cover" src="/img/ma3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Notes for Lecture 11-14</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/07/Network/Network_Layor/" title="Network"><img class="cover" src="/img/ma3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="title">Network</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">YunDid</div><div class="author-info__description">欢迎来到 YunDid's Blog！有疑问可以到 “留言板” 提问！^_^</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">46</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/YunDid"><i class="fab fa-github"></i><span>博主的GitHub首页</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/YunDid" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:512862613@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">萌新一枚~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88"><span class="toc-number">1.</span> <span class="toc-text">TCP&#x2F;IP协议栈</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">OSI七层模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OSI%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">OSI实现过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ethernet%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">Ethernet协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">IP协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.</span> <span class="toc-text">ARP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ARP%E6%94%BB%E5%87%BB"><span class="toc-number">1.4.1.</span> <span class="toc-text">ARP攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">底层原理分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARP%E9%98%B2%E5%BE%A1"><span class="toc-number">1.4.2.</span> <span class="toc-text">ARP防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.5.</span> <span class="toc-text">ICMP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP%E5%8D%8F%E8%AE%AE%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">ICMP协议应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ping%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">Ping命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trace-route-tracert"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">Trace route&#x2F;tracert</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.6.</span> <span class="toc-text">端口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.6.1.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.7.</span> <span class="toc-text">UDP协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.8.</span> <span class="toc-text">DNS协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DHCP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.9.</span> <span class="toc-text">DHCP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E5%AD%97%E6%AE%B5"><span class="toc-number">1.9.2.</span> <span class="toc-text">协议字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.9.3.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-number">1.9.4.</span> <span class="toc-text">不同系统下的差异</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-Unix"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">Linux&#x2F;Unix</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-Mac-os"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">Windows&#x2F;Mac os</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.9.5.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Soctet%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">1.10.</span> <span class="toc-text">Soctet套接字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.11.</span> <span class="toc-text">TCP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E6%8A%A5%E6%96%87%E6%AE%B5%E9%A6%96%E9%83%A8"><span class="toc-number">1.11.1.</span> <span class="toc-text">TCP报文段首部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E7%AD%89%E5%BE%85%E5%8D%8F%E8%AE%AE-%E8%87%AA%E5%8A%A8%E9%87%8D%E4%BC%A0%E8%AF%B7%E6%B1%82ARQ"><span class="toc-number">1.11.2.</span> <span class="toc-text">停止等待协议  &#x2F; 自动重传请求ARQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E7%BB%ADARQ%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.11.3.</span> <span class="toc-text">连续ARQ协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93"><span class="toc-number">1.11.4.</span> <span class="toc-text">可靠传输</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">滑动窗口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E7%9A%84RTO%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">重传时间的RTO的选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">1.11.5.</span> <span class="toc-text">TCP流量控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">1.11.6.</span> <span class="toc-text">TCP拥塞控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E8%BF%90%E8%BE%93%E7%AE%A1%E7%90%86"><span class="toc-number">1.11.7.</span> <span class="toc-text">TCP运输管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ETCP%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.11.8.</span> <span class="toc-text">基于TCP的协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Telnet%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.12.</span> <span class="toc-text">Telnet协议</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/Matlab/Matlab/" title="Matlab 入门"><img src="/img/ma3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Matlab 入门"/></a><div class="content"><a class="title" href="/2023/02/27/Matlab/Matlab/" title="Matlab 入门">Matlab 入门</a><time datetime="2023-02-27T01:30:00.000Z" title="发表于 2023-02-27 09:30:00">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/22/Animation/CenterAI_%E7%A5%9E%E7%BB%8F%E7%8A%B6%E6%80%81%E6%9C%BA/" title="Siggraph Asia 2019 - 神经状态机"><img src="/img/ma3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Siggraph Asia 2019 - 神经状态机"/></a><div class="content"><a class="title" href="/2022/03/22/Animation/CenterAI_%E7%A5%9E%E7%BB%8F%E7%8A%B6%E6%80%81%E6%9C%BA/" title="Siggraph Asia 2019 - 神经状态机">Siggraph Asia 2019 - 神经状态机</a><time datetime="2022-03-22T02:40:00.000Z" title="发表于 2022-03-22 10:40:00">2022-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/22/Unreal/Ue4_GamePlay%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/" title="YumiGame - Ue4 - GamePlay"><img src="/img/ma3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="YumiGame - Ue4 - GamePlay"/></a><div class="content"><a class="title" href="/2022/03/22/Unreal/Ue4_GamePlay%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3/" title="YumiGame - Ue4 - GamePlay">YumiGame - Ue4 - GamePlay</a><time datetime="2022-03-22T02:30:00.000Z" title="发表于 2022-03-22 10:30:00">2022-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/22/Unreal/Ue4_%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F%E6%9C%AA%E5%AE%8C/" title="Ue4 - Animation System"><img src="/img/ma3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ue4 - Animation System"/></a><div class="content"><a class="title" href="/2022/03/22/Unreal/Ue4_%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F%E6%9C%AA%E5%AE%8C/" title="Ue4 - Animation System">Ue4 - Animation System</a><time datetime="2022-03-22T02:28:00.000Z" title="发表于 2022-03-22 10:28:00">2022-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/22/Unity/Unity_%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F/" title="Unity - Animation Systems"><img src="/img/ma3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity - Animation Systems"/></a><div class="content"><a class="title" href="/2022/03/22/Unity/Unity_%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F/" title="Unity - Animation Systems">Unity - Animation Systems</a><time datetime="2022-03-22T02:27:00.000Z" title="发表于 2022-03-22 10:27:00">2022-03-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By YunDid</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><i class="fab fa-qq"></i> 512862613 | <i class="fab fa-weixin"></i> Mmm-myy1</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'RUIbtPgCc0o0TGaeqMWlX9P5-gzGzoHsz',
      appKey: 'PaoiG1dlQjiDQAVRBexH6KkR',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"position":"left","width":150,"height":300,"hOffset":20,"vOffset":-90},"mobile":{"show":true,"scale":1},"react":{"opacityDefault":0.3,"opacityOnHover":0.3,"opacity":0.95},"log":false});</script></body></html>